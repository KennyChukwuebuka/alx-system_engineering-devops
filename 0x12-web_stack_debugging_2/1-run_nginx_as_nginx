#!/usr/bin/env bash

# Define variables
NGINX_CONF_FILE="/etc/nginx/nginx.conf"
NGINX_USER="nginx"
NGINX_LISTEN_IP="0.0.0.0"
NGINX_LISTEN_PORT="8080"
NGINX_SERVICE="nginx"

# Check if the script is executed with root privileges
if [ "$(id -u)" != "0" ]; then
    echo "This script must be run as root or with sudo."
    exit 1
fi

# Update Nginx configuration to use the nginx user and listen on the specified IP and port
sed -i "s/user www-data;/user $NGINX_USER;/g" $NGINX_CONF_FILE
sed -i "s/listen 80;/listen $NGINX_LISTEN_IP:$NGINX_LISTEN_PORT;/g" $NGINX_CONF_FILE

# Restart Nginx service to apply the changes
service $NGINX_SERVICE restart

echo "Nginx is now running as $NGINX_USER, listening on $NGINX_LISTEN_IP:$NGINX_LISTEN_PORT."

